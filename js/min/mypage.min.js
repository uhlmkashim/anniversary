"use strict";
var icount = window.icount,
    getAudio = window.getAudio;
if ($(function() {
        function o() {
            var o = Math.floor(Math.random() * w);
            return w < 5 && o == w - 1 && (o = 4), o
        }

        function e(o, e, i) {
            var a = o.card_comment;
            p.removeClass().addClass("comment_main_idol_top comment_attribute_" + o.attribute_str).html(a).show(), void 0 == i ? p.addClass("position0" + e) : p.addClass(i)
        }

        function i(o, e, i) {
            var a, t;
            void 0 !== i ? (a = "position_left", t = "position_right") : (a = "position" + o.position, t = "position" + e.position), p.removeClass().addClass("comment_main_idol_top comment_attribute_" + o.attribute + " " + a).html(o.card_comment), v.parent().show(), v.removeClass().addClass("comment_main_idol_bottom comment_attribute_" + e.attribute + " " + t).html(e.card_comment)
        }

        function a(o, e) {
            var i = o.voice_path;
            i ? idolVoice.check.isVoicePlay() ? ($("#jsBtnIdolVoice").removeClass().addClass("se_000 btn_idol_voice attribute_" + f[o.attribute] + "_voice_mark_02").attr("rel", e).attr("title", f[o.attribute]).show(), idolVoice.load(i, l, e)) : $("#jsBtnIdolVoice").removeClass().addClass("se_000 btn_idol_voice attribute_" + f[o.attribute] + "_voice_mark_03").show() : $("#jsBtnIdolVoice").hide()
        }

        function t() {
            d = !1, setTimeout(function() {
                d = !0
            }, 500)
        }

        function s(o) {
            var e = B[l][o];
            e.rarity <= 4 && (999 == e.cost ? $("#jsAreaMainIdol").addClass("notSrare rare_" + e.rarity + "_tr") : $("#jsAreaMainIdol").addClass("notSrare rare_" + e.rarity + "_" + f[e.attribute])), $("#jsAreaMainIdol").css("background-image", "url(" + e.img_path_large + ")"), g[0] = o, C = !1
        }

        function n() {
            var o = B.dialogue_info[l];
            $("#jsAreaDialogue").show(), o.idol_1.rarity <= 4 && $("#jsAreaDialogue_idol1").addClass("notSrare rare_" + o.idol_1.rarity + "_" + j[o.idol_1.attribute]), $("#jsAreaDialogue_idol1").css("background-image", "url(" + B[l][o.idol_1.position.replace("0", "")].img_path_large + ")"), o.idol_2.rarity <= 4 && $("#jsAreaDialogue_idol2").addClass("notSrare rare_" + o.idol_2.rarity + "_" + j[o.idol_2.attribute]), $("#jsAreaDialogue_idol2").css("background-image", "url(" + B[l][o.idol_2.position.replace("0", "")].img_path_large + ")"), o.idol_1.dialogue_position > 0 ? $("#jsAreaDialogue_idol1").addClass("idol_talk_pos" + o.idol_1.dialogue_position) : $("#jsAreaDialogue_idol1").addClass("idol_talk_pos000"), o.idol_2.dialogue_position > 0 ? $("#jsAreaDialogue_idol2").addClass("idol_talk_pos" + o.idol_2.dialogue_position) : $("#jsAreaDialogue_idol2").addClass("idol_talk_pos000"), i(o.idol_1, o.idol_2, 1), g[0] = o.idol_1.position.replace("0", ""), g[1] = o.idol_2.position.replace("0", "")
        }
        var l, d = !0,
            r = ["atk", "def"];
        l = Commonjs.loadLocalStorage("myStudioIdolDeckType") ? Commonjs.loadLocalStorage("myStudioIdolDeckType") : r[Math.floor(2 * Math.random())];
        var c = {
                atk: "atk_def",
                def: "def_atk"
            },
            _ = $("#jsBtn_a-d_Switch"),
            m = $("#jsBtn_layout_change"),
            u = $("#jsBtn_comment_change"),
            g = [0, 0],
            h = $("#jsAreaMainIdolLarge"),
            p = $("#jsCommentTop"),
            v = $("#jsCommentBottom"),
            f = {
                1: "cu",
                2: "co",
                3: "pa",
                99: "tr"
            },
            j = {
                cute: "cu",
                cool: "co",
                passion: "pa"
            },
            w = 0,
            C = !1,
            I = window.user_name,
            S = 0,
            b = !1,
            y = {
                ONLY_COMMENT: 1,
                NO_UI: 2,
                FULL_UI: 3
            },
            A = y.ONLY_COMMENT,
            M = window.loading_images,
            L = window.loading_image_ami,
            k = window.native_app_flg,
            B = window.idolArr,
            V = window.is_debug,
            D = window.se_play,
            P = window.url_ajax_get_card_comment,
            T = window.url_bg_idol_5;
        if (2, k) var O = !0;
        if (V && console.log(B), $(".lesson_comp, .lesson_comp_lvup").size() > 0 && $("#jsPetitViewSwitch").find("div").addClass("img_lesson_complete lesson_complete"), 2 == Commonjs.loadLocalStorage("PetitMypagePosition") ? ($("#jsPetitViewSwitch").find("div").hide(), $("#jsPetitViewSwitch").removeClass("btn_change_petit").addClass("btn_change_normal"), $("#jsAreaMainIdol").addClass("_slideOut"), $("#jsAreaPetit").addClass("_slideIn").show(), Commonjs.saveLocalStorage("PetitMypagePosition", 2)) : ($("#jsPetitViewSwitch").find("div").show(), $("#jsAreaMainIdol").show()), _.removeClass().addClass("btn_change_base btn_change_" + c[l]), 1 == Commonjs.loadLocalStorage("myStudioIdolViewIsSingle") && void 0 !== B[l][Commonjs.loadLocalStorage("myStudioIdolPosition")]) S = Commonjs.loadLocalStorage("myStudioIdolPosition"), $("#jsBtnIdolCtrl").css("visibility", "hidden"), _.hide(), m.show(), void 0 === B.dialogue_info[l] || 1 != B.dialogue_info[l].is_dialogue || B[l][S].img_path_large != B.dialogue_info[l].idol_1.img_path_large && B[l][S].img_path_large != B.dialogue_info[l].idol_2.img_path_large ? (u.show(), s(S), e(B[l][S], S, "position04"), a(B[l][S], S)) : (C = !0, n()),
            function() {
                for (var o = [], e = 0; e < B[l].length; e++) void 0 !== B[l][e] && (o[e] = new Image, o[e].onload = function(o, e) {
                    return function() {
                        $("#jsBtn5Idol_po" + o).css("background-image", "url(" + e + ")").addClass("jsIdolReady"), B[l].length == o + 1 && (setTimeout(function() {
                            $("#jsBtn5Idol_po" + S).trigger("click")
                        }, 100), setTimeout(function() {
                            $("#jsBtnIdolCtrl").css("visibility", "visible")
                        }, 500))
                    }
                }(e, B[l][e].img_path), o[e].src = B[l][e].img_path, w++)
            }();
        else {
            for (var x = 0; x < B[l].length; x++)
                if (void 0 !== B[l][x]) {
                    $("#jsBtn5Idol_po" + x).css("background-image", "url(" + B[l][x].img_path + ")").addClass("jsIdolReady");
                    var N = B[l][x].strength_level;
                    if (N > 0) {
                        $("#jsBtn5Idol_po" + x).addClass("strength_card_effe_wrap");
                        var U = $('<img class="strength_level_img" />');
                        U.attr("src", B[l][x].strength_level_img_path).css("width", "64px"), U.appendTo("#jsBtn5Idol_po" + x)
                    }
                    w++
                } S = o(), void 0 !== B.dialogue_info[l] && 1 == B.dialogue_info[l].is_dialogue ? (C = !0, i(B.dialogue_info[l].idol_1, B.dialogue_info[l].idol_2)) : (C = !1, e(B[l][S], S), a(B[l][S], S))
        }
        _.on("click", function(i) {
            var s = $(i.currentTarget);
            if (!b) {
                l = "atk" == l ? "def" : "atk", $(s).removeClass().addClass("btn_change_base btn_change_" + c[l]);
                for (var n = 0; n < B[l].length - 1; n++)
                    if ($("#jsBtn5Idol_po" + n).removeClass("strength_card_effe_wrap"), $("#jsBtn5Idol_po" + n).find(".strength_level_img").remove(), void 0 !== B[l][n]) {
                        $("#jsBtn5Idol_po" + n).css("background-image", "url(" + B[l][n].img_path + ")");
                        var d = B[l][n].strength_level;
                        if (d > 0) {
                            $("#jsBtn5Idol_po" + n).addClass("strength_card_effe_wrap");
                            var r = $('<img class="strength_level_img" />');
                            r.attr("src", B[l][n].strength_level_img_path).css("width", "64px"), r.appendTo("#jsBtn5Idol_po" + n)
                        }
                    } C && (v.parent().hide(), C = !1), S = o(), e(B[l][S], S), a(B[l][S], S), Commonjs.saveLocalStorage("myStudioIdolDeckType", l), t()
            }
            i.preventDefault()
        }), m.on("click", function(o) {
            var e = $(o.currentTarget),
                i = $(e);
            if (!b) {
                switch (A) {
                    case y.ONLY_COMMENT:
                        $("#jsPetitViewSwitch").hide(), u.show(), $(".js_comment_off_target").hide(), p.show(), B[l][Commonjs.loadLocalStorage("myStudioIdolPosition")].voice_path && $("#jsBtnIdolVoice").show();
                        break;
                    case y.NO_UI:
                        $("#jsPetitViewSwitch").hide(), u.hide(), $(".js_comment_off_target").hide(), p.hide(), $("#jsBtnIdolVoice").hide();
                        break;
                    case y.FULL_UI:
                    default:
                        $("#jsPetitViewSwitch").show(), u.show(), $(".js_comment_off_target").show(), p.show(), B[l][Commonjs.loadLocalStorage("myStudioIdolPosition")].voice_path && $("#jsBtnIdolVoice").show()
                }++A >= 4 && (A = 1), i.removeClass("btn_change_pattern_1 btn_change_pattern_2 btn_change_pattern_3").addClass("btn_change_pattern_" + A), C && (u.hide(), $("#jsBtnIdolVoice").hide(), v.parent().toggle(p.is(":visible"))), o.preventDefault()
            }
        });
        var E = $("#jsBtnIdolCtrl li");
        $("#jsBtnIdolCtrl a").each(function(o, i) {
            var r = $(i);
            r.on("click", function(o) {
                if (S = r.data("po"), d) {
                    if (r.hasClass("jsIdolReady")) {
                        _.hide(), m.show(), h.show(), !C || S != B.dialogue_info[l].idol_1.position.replace("0", "") && S != B.dialogue_info[l].idol_2.position.replace("0", "") ? ($("#jsTipsSwitch").show().css("opacity", "1"), setTimeout(function() {
                            $("#jsTipsSwitch").css("opacity", "0")
                        }, 500), $("#jsBtnIdolVoice").hide(), p.hide(), v.parent().hide(), s(S), e(B[l][S], S, "position04"), a(B[l][S], S), setTimeout(function() {
                            u.show()
                        }, 300)) : n(), Commonjs.saveLocalStorage("myStudioIdolViewIsSingle", 1), Commonjs.saveLocalStorage("myStudioIdolPosition", S), Commonjs.saveLocalStorage("myStudioIdolDeckType", l);
                        for (var i = 0; i < E.length; i++) E.index(r.parent()) <= i ? E.eq(i).css("left", 64 * (5 - i) + "px") : E.eq(i).css("left", -1 * (i + 1) * 64 + "px");
                        k && O ? O = !1 : D("se_004")
                    }
                    t()
                }
                o.preventDefault()
            })
        }), h.on("click", function(o) {
            $(o.currentTarget);
            d && ($("#jsTipsSwitch").hide().css("opacity", "1"), A != y.ONLY_COMMENT && (A = y.FULL_UI, m.trigger("click")), h.hide(), E.css("left", "0"), u.hide(), C ? setTimeout(function() {
                "none" == p.css("display") && (p.show(), v.parent().show()), m.hide(), _.show(), p.removeClass("position_left").addClass("position0" + g[0]), v.removeClass("position_right").addClass("position0" + g[1]), $("#jsAreaDialogue_idol1").removeClass(), $("#jsAreaDialogue_idol2").removeClass(), $("#jsAreaDialogue").hide()
            }, 300) : setTimeout(function() {
                "none" == p.css("display") && (p.show(), B[l][Commonjs.loadLocalStorage("myStudioIdolPosition")].voice_path && $("#jsBtnIdolVoice").show()), m.hide(), _.show(), p.removeClass("position04").addClass("position0" + g[0]), $("#jsAreaMainIdol").removeClass().addClass("area_main_idol").css("background-image", "url(" + T + ")")
            }, 300), D("se_022"), Commonjs.saveLocalStorage("myStudioIdolViewIsSingle", 0), t()), o.preventDefault()
        }), $("#jsBtn_comment_change").on("click", function() {
            var o = Math.floor(1e3 * Math.random()) + 1;
            b || (b = !0, $("#commentLoading").show(), 500 === o || 501 === o ? ($("#loadingImage").attr("src", L), $("#loadingAmi").show(), $("#loadingNormal").hide()) : ($("#loadingImage").attr("src", M[Math.floor(Math.random() * M.length)]), $("#loadingAmi").hide(), $("#loadingNormal").show()), $.ajax({
                type: "post",
                url: P,
                data: {
                    user_name: I,
                    is_leader_flag: +("4" == S),
                    position: S,
                    comment_column_num: B[l][S].comment_column_num,
                    atk_flag: +("atk" == l)
                },
                success: function(o) {
                    B[l][S].card_comment = Commonjs.unescapeHTML(Commonjs.unescapeHTML(o.card_comment)), B[l][S].voice_path = o.voice_path, B[l][S].comment_column_num = o.comment_column_num
                },
                error: function() {
                    alert("通信に失敗しました。")
                },
                complete: function() {
                    $("#commentLoading").hide(), b = !1, e(B[l][S], S, "position04"), a(B[l][S], S)
                }
            }))
        }), $("#jsBtnIdolVoice").on("click", function(o) {
            idolVoice.play(l, $("#jsBtnIdolVoice").attr("rel")), o.preventDefault()
        }), $("#jsPetitViewSwitch").on("click", function(o) {
            var e = $(o.currentTarget);
            d && ($("#jsAreaMainIdol, #jsAreaPetit").addClass("_animation").show(), $(e).hasClass("btn_change_petit") ? ($("#jsAreaMainIdol").addClass("_slideOut"), $("#jsAreaPetit").addClass("_slideIn"), Commonjs.saveLocalStorage("PetitMypagePosition", 2)) : ($("#jsAreaMainIdol").removeClass("_slideOut"), $("#jsAreaPetit").removeClass("_slideIn"), Commonjs.saveLocalStorage("PetitMypagePosition", 1)), D("se_007"), t()), o.preventDefault()
        }), $("#jsAreaMainIdol").on("webkitTransitionEnd", function(o) {
            var e = $(o.currentTarget);
            $(e).hasClass("_slideOut") ? ($("#jsPetitViewSwitch").find("div").hide(), $("#jsPetitViewSwitch").removeClass("btn_change_petit").addClass("btn_change_normal")) : ($("#jsPetitViewSwitch").find("div").show(), $("#jsPetitViewSwitch").removeClass("btn_change_normal").addClass("btn_change_petit"))
        }), $(".jsOnBanner a, .jsOnBanner img").each(function(o, e) {
            var i = $(e);
            i.on("touchstart mousedown", function() {
                i.removeClass("offBanner").addClass("onBanner")
            }), i.on("touchend  mouseup mouseleave", function() {
                i.removeClass("onBanner").addClass("offBanner")
            })
        });
        var F = $("#user_name_txt");
        F.text().length > 11 && $(F).css("font-size", "10px");
        var Y = $(".newInfoBody li");
        Y.on("touchstart mousedown", function(o) {
            var e = $(o.currentTarget);
            $(e).addClass("jsOnLightbox")
        }), Y.on("touchend mouseup mouseleave", function(o) {
            var e = $(o.currentTarget);
            $(e).removeClass("jsOnLightbox")
        }), $("#jsBtnAreaMessageMore").on("click", function(o) {
            var e = $(o.currentTarget),
                i = $("#areaMessageMore");
            "none" == i.css("display") ? (i.slideDown(350), $(e).addClass("_close"), Commonjs.saveLocalStorage("myStudioAreaMessageMore", 1)) : (i.slideUp(350), $(e).removeClass("_close"), Commonjs.saveLocalStorage("myStudioAreaMessageMore", 0)), o.preventDefault()
        }), $("#jsBtnAreaMessageMore").size() > 0 && 1 == Commonjs.loadLocalStorage("myStudioAreaMessageMore") && ($("#areaMessageMore").show(), $("#jsBtnAreaMessageMore").addClass("_close"))
    }), void 0 !== window.countIdList)
    for (var index in window.countIdList) icount.addCount(window.countIdList[index], $(window.countIdList[index]).data("end"));
var idolVoice = idolVoice || {
    init: {
        voiceDataArr: {
            atk: [],
            def: []
        }
    },
    check: {
        hasLocalStorage: function() {
            return !!window.localStorage
        },
        isVoicePlay: function() {
            return !(!this.hasLocalStorage() || "OFF" == Commonjs.loadLocalStorage("IdolVoiceAdmitSwitch"))
        }
    },
    load: function(o, e, i) {
        idolVoice.check.isVoicePlay() && (this.init.voiceDataArr[e][i] = getAudio(""), this.init.voiceDataArr[e][i].autoplay = !1, this.init.voiceDataArr[e][i].src = o, this.init.voiceDataArr[e][i].addEventListener("pause", function() {
            $("#jsBtnIdolVoice").removeClass().addClass("se_000 btn_idol_voice attribute_" + $("#jsBtnIdolVoice").attr("title") + "_voice_mark_02")
        }), this.init.voiceDataArr[e][i].addEventListener("play", function() {
            $("#jsBtnIdolVoice").removeClass().addClass("se_000 btn_idol_voice attribute_" + $("#jsBtnIdolVoice").attr("title") + "_voice_mark_04")
        }))
    },
    play: function(o, e) {
        idolVoice.check.isVoicePlay() && (this.init.voiceDataArr[o][e].ended ? this.init.voiceDataArr[o][e].play() : this.init.voiceDataArr[o][e].paused ? this.init.voiceDataArr[o][e].play() : (this.init.voiceDataArr[o][e].paused, this.init.voiceDataArr[o][e].pause()))
    }
};
